<div class="chat-header">
    <h3>ãƒãƒ£ãƒ³ãƒãƒ«å : <%= channel.channelName %></h3>
    <p>ãƒãƒ£ãƒ³ãƒãƒ«è©³ç´° : <%= channel.channelDetail %></p>
    <p>ãƒãƒ£ãƒ³ãƒãƒ«ä½œæˆè€… : <%= channel.createdBy %></p>
</div>

<div class="chat-saving">
    <% for(var i=0;i<channel.chatData.length;i++) { %>
        <div class="newDate">
            <p><%= channel.chatData[i].date %></p>
            <% for(var j=0;j<channel.chatData[i].messages.length;j++) { %>
                <div class="chat-devider">
                    <a href="/users/<%= channel.chatData[i].messages[j].userId %>"><%= channel.chatData[i].messages[j].username %></a>
                    <p><%= channel.chatData[i].messages[j].time %></p>
                    <p class="message"><%= channel.chatData[i].messages[j].text %></p>
                    <input class="msgId" type="hidden" value="<%= channel.chatData[i].messages[j]._id %>">
                </div>
            <% } %>
        </div>
    <% } %> 
</div>


<div id="chat">
    <div class="chatDate">
        <p class="dateEmitter"></p> <!-- ã“ã“ã«1æ—¥ä¸€åº¦ã®ã¿å‡ºåŠ›ã‚’ã•ã›ã‚‹ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰ã—ãŸã‚‰æ¶ˆãˆã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹ãƒ»ã¤ã¾ã‚Šsocketã‹ã‚‰ã®å‡ºåŠ›ï¼‰ -->
    </div>
    <div class="socket-saving">
        <a href="#" class="socketUser"></a>
        <p class="socketTime"></p>
        <p class="socketMsg" onmouseover="mouseover()" onmouseout="mouseout()"></p>
        <input type="hidden" class="customId" value="">
    </div>
</div>

<% if(currentUser) { %> 
    <form id="chat-form">
        <input id="chat-input" type="text"ã€€placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸">
        <input id="chat-id" type="hidden" value="<%= currentUser._id %>">
        <input type="submit" value="é€ä¿¡" id="click">
    </form>
<% } %> <!-- æ¯”è¼ƒç”¨ã«chat-idã®ã¿æ®‹ã—ã¦ã‚ã‚‹ãŒã€ã“ã‚Œã‚‚sessionã«åˆ‡ã‚Šæ›¿ãˆãŸã‚‰ã€ifã‚‚ã‚ã¨ã‚‚æ¶ˆã™ æœ€çµ‚ä¸‹ã®-->

<!-- <form id="chat-form">
    <input id="chat-input" type="text"ã€€placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸">
    <input type="submit" value="é€ä¿¡" id="click">
</form> -->



<!-- æƒ³å®šã€€ç¾åœ¨ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ãŸè¦ç´ ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä¸€è‡´ã—ãŸå ´åˆã¯ã€ãã®è¦ç´ ã®ç·¨é›†ã‚’å¯èƒ½ã¨ã™ã‚‹popupã‚’å‡ºç¾ã•ã›ã‚‹ã€‚ã•ã‚‚ãªãã°ã€è¿”ä¿¡ã‚„åå¿œç­‰ã®popup -->

<div class="selfMsgResponser">
    <div class="response">
        <button>ğŸ‘</button>
        <button>ğŸ‘</button>
    </div>
    <input type="button" class="replyMsg" value="è¿”ä¿¡">
    <!-- ä¸‹è¨˜äºŒã¤ã«é–¢ã—ã¦ã¯ã€ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã§ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç·¨é›†ã‚‚ã—ãã¯å‰Šé™¤ã®popupå‡ºç¾ -->
    <input type="button" class="updateMsg" value="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç·¨é›†">
    <input type="button" class="deleteMsg" value="é€ä¿¡å–æ¶ˆ">
</div>

<div class="msgResponser">
    <div class="response">
        <button>ğŸ‘</button>
        <button>ğŸ‘</button>
    </div>
    <input type="button" class="replyMsg" value="è¿”ä¿¡">
</div>

<div class="toUpdate">
    <input type="text" class="newMsg" value=""><!-- ã“ã“ã«ã€ç¾åœ¨è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ -->
    <input type="button" class="close-popup" value="ã‚­ãƒ£ãƒ³ã‚»ãƒ«">
    <input type="submit" class="update" value="å¤‰æ›´ã‚’ä¿å­˜ã™ã‚‹">
</div>

<script type="module" src="https://cdn.jsdelivr.net/gh/tracker1/node-uuid4/browser.mjs"></script>
<script src="/socket.io/socket.io.js"></script>
<script type="module" src="/javascripts/chats/socket.js"></script>

<script>
    /* ã‚ãã¾ã§ä»®ç½®ãã€€åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«ç§»ã—ãŸã„ï¼ˆsocket.jsï¼‰ */
    var userId = document.getElementById("chat-id").value;
    function mouseover(){//ä¸€å¿œæ©Ÿèƒ½ã¯ã—ã¦ã„ã‚‹ã‘ã©ã€ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºåŠ›ã•ã‚Œã¦ã—ã¾ã†
        var data = jQuery(":hover")[4];
        var pointedId = data.children[0].href.split("/")[4];
        var customId = data.children[3].value; //ã“ã‚Œã‚’ç”¨ã„ã¦ç·¨é›†ã‚’ã™ã‚‹å ´æ‰€ã®æŒ‡å®šã‚’ã™ã‚‹

        if(pointedId===userId){
            $(".selfMsgResponser").addClass(".show").fadeIn();
            return true;
        }else{
            $(".msgResponser").addClass(".show").fadeIn();
            return false;
        }
    };

    function mouseout(){
        if(mouseover()){
            $(".selfMsgResponser").fadeOut();
        }else{
            $(".msgResponser").fadeOut();
        }
    };
</script>

<style>
    .msgResponser{
        display: none;
    }
    .selfMsgResponser{
        display: none;
    }
    .show{
        display: flex;
        opacity: 1;
    }

    .toUpdate{
        display: none;
    }
</style>

<!-- opacityãŒä¸æº€ã§ã‚ã‚‹å ´åˆã€ã‚¯ãƒ©ã‚¹ã®å‰Šé™¤ã‚’æ¤œè¨ã™ã‚‹ -->