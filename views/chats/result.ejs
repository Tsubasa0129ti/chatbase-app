
<form action="/chat/channel" method="GET">
    <input type="text" id="search" name="search" placeholder="検索">
    <select name="sort" class="sort">
        <option value=0>更新順（新）</option><!-- 流石に名称は変える -->
        <option value=1>更新順（古）</option>
        <option value=2>作成順（新）</option>
        <option value=3>作成順（古）</option>
    </select>
    <input type="hidden" name="page" value="1">
    <input type="submit" value="検索">
</form>

<div class="title">
    <h2>検索結果</h2>
    <p><%= count %>件の結果が見つかりました。</p>
    <input type="hidden" class="searchResult" value="<%= count %>">
</div>

<div class="chat-result">
    <% if(count===0) { %>
        <div class="no-result">
            <p>他のキーワードで検索し直してください。</p>
        </div>
    <% }else { %>
        <div class="result">
            <% for(var i=0;i<10;i++){ %> <!-- ここの数値は迷い中 -->
                <% if(channel[i]){ %>
                    <a href="/chat/<%= channel[i]._id %>"><%= channel[i].channelName %></a>
                    <p><%= channel[i].channelDetail %></p>
                    <p><%= channel[i].createdBy %></p>
                <% } %>
            <% }　%>
        </div>
        <div class="pagination">   
            <a id="previous">&lt;&lt;</a>
            <a id="next">&gt;&gt;</a>
            <a id="currentPage"></a>
        </div>
    <% } %>
</div>

<div class="channel-creater">
    <p>チャンネル</p>
    <a id="addChannel" style="cursor: pointer;">＋</a>
</div>

<form class="popup" id="popup" name="test">
    <div class="content">
        <div class="popup-header">
            <h3>チャンネルを作成する</h3>
            <p class="close-popup" style="cursor: pointer;">×</p>
        </div>
        <div class="description">
            <label for="description">説明</label>
            <p>ここにチャンネル作成の説明を記載。</p>
        </div>
        <div id="errorMsg"></div>
        <div class="channnelName">
            <label for="name">名前</label>
            <input type="text" name="channelName" id="chanName">
        </div>
        <div class="detail">
            <label for="detail">説明</label>
            <input type="text" name="channelDetail" id="chanDetail" required>
        </div>
        <div class="createdBy">
            <input type="hidden" name="createdBy" value="<%= currentUser._id %>">
        </div>
        <input type="submit" value="作成" id="popup-end" required>
    </div>    
</form>

    

<script src="/jquery/test.js"></script>
<script src="/javascripts/chats/modalForm.js"></script>

<script>
    window.addEventListener("DOMContentLoaded",() => {

        var urlParams = new URLSearchParams(window.location.search); //urlの取得
        var currentPage = parseInt(urlParams.get("page"));
        
        var searchResult = document.getElementsByClassName("searchResult")[0].value;
        var lastPage = Math.ceil(searchResult/5);

        //再検索の際のoptionの初期値の設定
        var initial = urlParams.get("sort");
        var search = urlParams.get("search");

        var select = document.getElementsByClassName("sort")[0];
        for(var i=0;i<3;i++){
            if(initial ===select.options[i].value){
                select.options[i].selected = true;
            }
        };

        //pagination
        var pagination = document.getElementsByClassName("pagination")[0];
        var next = document.getElementById("next");
        var previous = document.getElementById("previous");
        var current = document.getElementById("currentPage");

        if(currentPage!==lastPage){
            next.href = `/chat/channel?search=${search}&sort=${initial}&page=${currentPage+1}`;
        }
        
        if(currentPage!==1){
            previous.href =  `/chat/channel?search=${search}&sort=${initial}&page=${currentPage-1}`;
        }

        
        if(currentPage<=lastPage){
            current.innerHTML = `${currentPage}/${lastPage}`;
        }else{
            while(pagination.lastChild){
                pagination.removeChild(pagination.lastChild);
            }
            var error = document.createElement("p");
            error.innerHTML = "指定したページは存在しません。";
            pagination.appendChild(error);
        }

    },false);
    
</script>

<style>
    .popup {
        display: none;
        height: 100vh;
        width: 100%;
        background: black;
        opacity: 0.7;
        position: fixed;
        top: 0;
        left: 0;
    }
    .content{
        background: #fff;
        padding: 30px;
        width: 50%;
    }
    .show {
        display: flex;
        justify-content: center;
        align-items: center;
    }
</style>